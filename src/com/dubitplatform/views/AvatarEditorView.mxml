<?xml version="1.0" encoding="utf-8"?>
<ui:AvatarEditorSkinViewBase 
	width="100%" height="100%"
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:ui="uk.co.dubit.platform.components.avatarEditor.ui.*" 
	xmlns:avatarEditor="com.dubitplatform.views.avatarEditor.*" 
	xmlns:editor="uk.co.dubit.platform.components.avatar.editor.*" xmlns:ui1="uk.co.dubit.platform.components.avatar.ui.*">
	
	<mx:Script>
		<![CDATA[
			import mx.events.ItemClickEvent;
			
			import uk.co.dubit.platform.components.avatarEditor.IAvatarEditor;
			import uk.co.dubit.platform.components.catalogue.IProductGroup;
			import uk.co.dubit.platform.components.catalogue.ui.ProductGroupLoadMode;
			import uk.co.dubit.properties.Properties;
			
			[Bindable]
			override public function set avatarEditor(value:IAvatarEditor) : void
			{
				super.avatarEditor = value;
				
				if(avatarEditor) avatarPreview.avatar = avatarEditor.avatar;
			}
			
			private function resetAvatar() : void
			{
				avatarEditor.resetAvatar();
				
				avatarPreview.avatar = avatarEditor.avatar;
			}
			
			private function onProductGroupClicked(e:ItemClickEvent) : void
			{				
				productGroupView.productGroup = IProductGroup(e.item);
			}
		]]>
	</mx:Script>
	
	<mx:TitleWindow title="Avatar customizer" 
					width="100%" height="100%" 
					showCloseButton="true" close="{ avatarEditor.close() }">
		
		<mx:Canvas width="100%" height="100%">
			<mx:HBox width="100%" height="100%">
				<mx:Form>
					<mx:FormHeading label="Avatar Preview" />
					<mx:FormItem>
						<mx:VBox>
							<ui1:AvatarView id="avatarPreview" width="160" height="240"
											action="stand" directionAngle="180" templateURL="{ Properties.getInstance().getProperty('path.anim-server') }"
											mouseChildren="false"
											buttonMode="true" filters="{[new DropShadowFilter(0, 45, 0x000000, 0.7, 5, 5, 1, 2)]}" />
							<mx:HBox width="100%" paddingLeft="10">
								<mx:Button label="Save appearance" click="{ avatarEditor.saveAvatar() }" />
								<mx:Button label="Reset" click="resetAvatar()" />
							</mx:HBox>
							
						</mx:VBox>
						
					</mx:FormItem>
				</mx:Form>
				
				<mx:Form width="100%" height="100%">
					<mx:FormHeading label="Clothing Categories" />
					<mx:FormItem width="100%" height="100%">
						<mx:VBox width="100%" height="100%">
							<mx:TabBar dataProvider="{ avatarEditor.productGroups }"
									   labelField="name"
									   itemClick="onProductGroupClicked(event)" />
							
							<avatarEditor:AvatarEditorProductGroupView id="productGroupView" 
																	   width="100%" height="100%"
																	   avatar="{ avatarEditor.avatar }"
																	   loadMode="{ ProductGroupLoadMode.OWNED }"
																	   productGroup="{ avatarEditor.selectedProductGroup }"
																	   clothingChanged="{ avatarPreview.load() }" />
						</mx:VBox>
					</mx:FormItem>
				</mx:Form>	
			</mx:HBox>	
		</mx:Canvas>
	</mx:TitleWindow> 
</ui:AvatarEditorSkinViewBase>