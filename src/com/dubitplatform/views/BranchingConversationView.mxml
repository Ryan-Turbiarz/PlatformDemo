<?xml version="1.0" encoding="utf-8"?>
<DialogueViewBase xmlns="uk.co.dubit.platform.components.dialogue.*" xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" verticalScrollPolicy="off" horizontalScrollPolicy="off" creationComplete="onCreationComplete();">
	
	<mx:Script>
		<![CDATA[
			import uk.co.dubit.asset.AssetManager;
			import uk.co.dubit.graphics.render2D.IRenderObject;
			import com.gskinner.utils.StringUtils;
			import uk.co.dubit.platform.scriptEngine.ScriptKeyword;
			import uk.co.dubit.platform.scriptEngine.gameObject.IGameObject;
			import uk.co.dubit.platform.components.dialogue.IResponse;
			import uk.co.dubit.platform.components.dialogue.DialogueEvent;
			import uk.co.dubit.platform.components.dialogue.DialogueModel;
			
			private function onCreationComplete () : void
			{
				filters = [new DropShadowFilter(0, 0, 0, 0.7, 40, 40, 1, 3)];
			}
			
			private function getNPCName (npc : IGameObject) : String
			{
				if (npc.hasAttribute(ScriptKeyword.NAME)) return npc.getValue(ScriptKeyword.NAME);
				return StringUtils.properCase(npc.id);
			}
			
			private function getNPCImage (npc : IGameObject) : String
			{
				if (npc.hasAttribute(ScriptKeyword.PREVIEW_URL)) return npc.getValue(ScriptKeyword.PREVIEW_URL);
				
				if (npc is IRenderObject) 
				{
					var renderObject : IRenderObject = npc as IRenderObject
					var assetID : String = renderObject.displayObject.material.assetID;
					
					if (assetID)
					{
						return AssetManager.getInstance().getAsset(assetID).url;
					}
				}
				
				return null;
			}
		]]>
	</mx:Script>
	
	<mx:Box width="100%" height="100%" backgroundColor="#333333" cornerRadius="2" shadowDistance="1" dropShadowEnabled="true"
		borderColor="#555555" borderStyle="solid" borderThickness="2">
	
		<mx:HBox width="100%" height="100%">
			
			<mx:VBox paddingLeft="5" paddingRight="5" paddingTop="10" paddingBottom="5" height="100%">
				<mx:Image source="{getNPCImage(DialogueModel.getInstance().activeDialogue.npc)}" height="100%" width="120" scaleContent="true"/>			
			</mx:VBox>
			
			<mx:VBox width="100%" height="100%" paddingLeft="5" paddingRight="5" paddingTop="10">
			
				<mx:List id="messageList" dataProvider="{ DialogueModel.getInstance().activeStatement.messages }" width="100%" height="30" variableRowHeight="true" useRollOver="false" borderStyle="none">
					<mx:itemRenderer>
						<mx:Component>
							<mx:Text text="{data}" width="100%" selectable="false" fontWeight="bold"/>
						</mx:Component>
					</mx:itemRenderer>
				</mx:List>
	
				
				<mx:HRule width="100%"/>
				
				<mx:List id="responseList" dataProvider="{ responses }" width="100%" height="110" variableRowHeight="true" change="{dispatchEvent( new DialogueEvent(DialogueEvent.PLAY_RESPONSE, IResponse(responseList.selectedItem) ) )}" borderStyle="none" verticalScrollPolicy="on">
					<mx:itemRenderer>
						<mx:Component>
							<mx:Text text="{data.message}" width="100%" selectable="false"/>
						</mx:Component>
					</mx:itemRenderer>
				</mx:List>			
			</mx:VBox>
			
		</mx:HBox>
		
	</mx:Box>

</DialogueViewBase>
