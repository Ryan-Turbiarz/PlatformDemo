<?xml version="1.0" encoding="UTF-8"?>
<ChatRoom id="mansion" xmlns:xi="http://www.w3.org/2001/XInclude">

	<xi:include href="includes/room_config.xml" />
	
	<Attribute key="startX" value="297" type="number" />
	<Attribute key="startY" value="600" type="number" />

	<MouseMovementController yVelocityScale="0.5"/>
	<CollisionController target="{Room.player}" />
	
	<Collisions>
		<Collision target="{Room.player}"/>
	</Collisions>
	
	<VerbController>
		<Verb id="OnLookAt" name="Look at"/>
		<Verb id="OnPickUp" name="Pick up"/>
		<Verb id="OnTalkTo" name="Talk to"/>
	</VerbController>	
	
	<Collision width="1296" height="700" id="walkableArea" solid="true">
		<Image assetID="hit"/>
	</Collision>
	
	<Filters id="playerFilters">
		<DepthFilter id="playerDepthFilter" scaleBack="-1.4" scaleFront="0.001" />
		<MultiplyFilter id="lightFilter">
			<Image id="light_filter" assetID="light_filter_asset" />
		</MultiplyFilter>	
	</Filters>
	
	<Sounds target="{Room.player}" >
		<Sound id="backgroundMusic" play="true" looping="true" assetID="music" />
	</Sounds>
	
	<Scene id="scene" target="{Room.player}" viewportWidth="784" viewportHeight="445" width="1296" height="700">
		<DisplayObject2D id="background" assetID="background" mouseEnabled="false" />
		<DisplayObject2D id="click" assetID="click" mouseEnabled="true" clickThrough="true" alpha="0"/>
		<ZSortingDisplayObject id="furniture">
			<DisplayObject2D id="rearporch" name="a big porch" assetID="rearporch" x="0" y="521" originX="0" originY="521" mouseEnabled="true" verbEnabled="true" clickThrough="true"/>
			<DisplayObject2D id="porch" assetID="porch" x="0" y="525" originX="0" originY="525" mouseEnabled="false"/>
			<DisplayObject2D id="shrubs1" assetID="shrubs1" x="0" y="665" originX="0" originY="665" mouseEnabled="false"/>
			<DisplayObject2D id="shrubs2" name="the shrubs" assetID="shrubs2" x="0" y="632" originX="0" originY="632" mouseEnabled="true" verbEnabled="true" clickThrough="true"/>
			<DisplayObject2D id="mansiondoor1" assetID="mansiondoor1" x="1296" y="618" originX="75" originY="100" mouseEnabled="true" verbEnabled="true" useHandCursor="true" distance = "140" clickThrough="true" collidable="true"/>
		</ZSortingDisplayObject>
		<DisplayObject2D id="foreground" assetID="foreground" x="0" y="0" originX="0" originY="0" mouseEnabled="false"/>
		<ZSortingDisplayObject id="playerMessages" />
	</Scene>
	
	<Assets>
		<Asset id="hit" url="[base.url]images/mansion/hit.png"/>
		<Asset id="click" url="[base.url]images/mansion/click.jpg"/>
	    <Asset id="light_filter_asset" url="[base.url]images/mansion/light.jpg"/>
		<Asset id="background" url="[base.url]images/mansion/background.jpg"/>
		<Asset id="music" url="[base.url]sounds/mansion/music.mp3" />
		<Asset id="shrubs1" url="[base.url]images/mansion/shrubs1.png"/>
		<Asset id="shrubs2" url="[base.url]images/mansion/shrubs2.png"/>
		<Asset id="porch" url="[base.url]images/mansion/porch.png"/>
		<Asset id="rearporch" url="[base.url]images/mansion/rearporch.png"/>
		<Asset id="foreground" url="[base.url]images/mansion/foreground.png"/>
		<Asset id="mansiondoor1" url="[base.url]images/mansion/mansiondoor1.png" />	
	</Assets>
	
	<Trigger event="OnClick" gameObject="{Room.click}">	
		<MoveTo gameObject="{Room.player}" targetX="{Event.x}" targetY="{Event.y}" >
			<Complete>
				<Trace message="Movement complete {Event.x} : {Event}"/>
				<AwardExperiencePoints points="8"/>
				<AddToBackpack possessionID="grog"/>
			</Complete>	
		</MoveTo>
		<AddToCollection collectionID="animalCollection" collectableID="dog"/>
	</Trigger>
	
	<Trigger event="OnClick" gameObject="{Room.player}">
		<OpenMenu menuID="playerMenu" target="{Room.player}" />
	</Trigger>

	<Trigger event="OnEnterCollision" gameObject="{Room.mansiondoor1}">
		<If expression="({Map.tacotikitownRoom.visible}=={true})">
			<Then>
				<ChangeRoom roomName="docks" useServer="false"/>
			</Then>	
		</If>		
	</Trigger>
	
	<Trigger event="OnLookAt" gameObject="{Room.rearporch}">
		<Trace message="OnLookAt rearporch"/>
		<ShowBubble gameObject="{Room.player}" message="Yep, it's the porch to the mansion. And what a porch!"/>
		<RemoveFromBackpack possession="{Backpack.grog}"/>
	</Trigger>
	
	<Trigger event="OnPickUp" gameObject="{Room.rearporch}">
		<Trace message="OnPickUp rearporch"/>
		<ShowBubble gameObject="{Room.player}" message="Hum, I'm not sure I can pick that up!"/>
		<UpdateAchievementScore score="110" achievementID="visitsToFriends"/>
	</Trigger>	
	
	<Trigger event="OnLookAt" gameObject="{Room.shrubs2}">
		<ShowBubble gameObject="{Room.player}" message="Ooh I've found a map with instructions to the docks, and the cannibal town!"/>
		<UpdateLocationVisibility locationID="darkdocksRoom" visible="true"/>
		<UpdateLocationVisibility locationID="tacotikitownRoom" visible="true"/>
	</Trigger>		
	
	<Trigger event="OnClick" gameObject="{Room.rearporch}">
		<Trace message="OnClick rearporch"/>
		<GotoAndPlay gameObject="{Room.dennis}" frame="2"/>
	</Trigger>
	
	<Trigger event="OnDragDrop" gameObject="{Room.shrubs2}">
		<Trace message="OnDragDrop dragInitiator={Event.dragInitiator}"/>
		<Switch value="{Event.dragInitiator.id}">
			<Rainwater>
				<ShowBubble gameObject="{Room.player}" message="The grass looks like it could use the water more than me!" />
				<RemoveFromBackpack collectable="{Event.dragInitiator}"/>
			</Rainwater>
			<Default>
				<ShowBubble gameObject="{Room.player}" message="I don't know how to use those together"/>
			</Default>	
		</Switch>	
	</Trigger>
	
	<BehaviourDefinition id="ShowPlayerBubble">
		<ShowBubble gameObject="{Room.player}" message="{Event.message}"/>
	</BehaviourDefinition>
</ChatRoom>