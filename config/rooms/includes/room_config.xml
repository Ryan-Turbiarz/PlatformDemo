<?xml version="1.0" encoding="UTF-8"?>
<Include xmlns:xi="http://www.w3.org/2001/XInclude">
	<xi:include href="player_definition.xml" />	
	<xi:include href="room_notification_handler.xml" />	

	<CollisionController target="{Room.player}" />
	<MouseMovementController yVelocityScale="0.3" directions="4" />
	
	<!-- Move the player when he clicks -->
<!--	<Trigger event="onClick" gameObject="{Room.click}">-->
<!--		<MoveTo targetX="{Event.x}" targetY="{Event.y}" />-->
<!--	</Trigger>-->

	<!-- These are the actions you can perform in the world -->
	<VerbController id="verbController"
		skin="com.dubitplatform.views.VerbControllerView"
		targetContainer="Verb" attachSkin="true"
		customCursorClass="uk.co.dubit.platform.components.verb.VerbCustomCursor">

		<Verb id="OnLookAt" name="Look at"/>
		<Verb id="OnPickUp" name="Pick up"/>
		<Verb id="OnTalkTo" name="Talk to"/>
		<Verb id="OnUse" name="Use the"/>
		<Verb id="OnRead" name="Read a book"/>
		
		<Triggers>
			<onVerbBarOpened>
			</onVerbBarOpened>
		</Triggers>
	</VerbController>

	<!-- Generic Messages for the Verb Bar -->
	<BehaviourDefinition id="cantLookAt">
		<ShowPlayerBubble message="It's a {Event.gameObject.name}" />
	</BehaviourDefinition>

	<BehaviourDefinition id="cantGrab">
		<ShowPlayerBubble message="I shouldn't, it's not mine" />
	</BehaviourDefinition>

	<BehaviourDefinition id="cantTalkTo">
		<ShowPlayerBubble message="I don't want to talk to that" />
	</BehaviourDefinition>
	
	<BehaviourDefinition id="readAction">
		<If expression="({Meters.energy.amount} >= {15})">
			<Then>
				<SetValues target="{Event}" reduction="({Skills.bookreading.points}*{200})" />
				<SetValues target="{ActivityBars.reading}" duration="({5000}-{Event.reduction})" />
				<OpenActivityBar activityBar="reading" targettedObject="{Event.handler}"/>
			</Then>
			<Else>
				<ShowBubble gameObject="{Room.player}" message="I'm too tired"/>
			</Else>
		</If>
	</BehaviourDefinition>
	
	<!-- Branching conversation dialogue -->
	<Dialogue id="dialogue" skin="com.dubitplatform.views.BranchingConversationView" targetContainer="dialogue">
		<Triggers>
			<OnMessage></OnMessage>
			<OnBeginDialogue>
				<OpenDialogue />
			</OnBeginDialogue>
			<OnCompleteDialogue></OnCompleteDialogue>
		</Triggers>
	</Dialogue>
</Include>