<?xml version="1.0" encoding="UTF-8"?>
<ChatRoom id="village" xmlns:xi="http://www.w3.org/2001/XInclude" startX="900" startY="600">

	<xi:include href="includes/room_config.xml"/>
		
	<CollisionMap id="walkableArea" assetID="hit_asset" />

	<Filters id="playerFilters">
		<DepthFilter id="playerDepthFilter" scaleBack="0.1" scaleFront="0.4"/>
		<LightMapFilter assetID="light_filter_asset" />
	</Filters>
	
	<Sounds target="{Room.player}" id="sounds">
		<StreamingSound id="water_1" url="sounds/stream.mp3" play="true" looping="true" x="350" y="580" carry="300" strength="0.7"/>
		<StreamingSound id="water_2" url="sounds/stream.mp3" play="false" looping="true" x="650" y="780" carry="300" strength="0.7"/>
		<StreamingSound id="woodland_1" url="sounds/woodland.mp3" play="true" looping="true" strength="0.5"/>
		<StreamingSound id="woodland_2" url="sounds/woodland.mp3" play="false" looping="true" strength="0.5"/>
		<StreamingSound id="room_music" url="sounds/theme_music.mp3" play="true" looping="true" strength="0.3"/>
		<StreamingSound id="mushroom_12_sound" url="sounds/mushroom_12.mp3" play="false" looping="false" />
		<StreamingSound id="mushroom_11_sound" url="sounds/mushroom_11.mp3" play="false" looping="false" />
		<StreamingSound id="mushroom_10_sound" url="sounds/mushroom_10.mp3" play="false" looping="false" strength="2"/>
		<StreamingSound id="mushroom_7_sound" url="sounds/mushroom_7.mp3" play="false" looping="false" />
		<StreamingSound id="mushroom_4_sound" url="sounds/mushroom_4.mp3" play="false" looping="false" />
		<StreamingSound id="winch" url="sounds/winch.mp3" play="false" looping="false" />
		<StreamingSound id="rumble" url="sounds/rumble.mp3" play="false" looping="false" />
	</Sounds>

	<Scene id="scene" target="{Room.player}" viewportWidth="1024" viewportHeight="768" width="1500" height="900">
		
		<ParallaxLayer mouseEnabled="false" xm="0.4" ym="0.4">
			<DisplayObject2D assetID="sky_asset" mouseEnabled="false"/>
		</ParallaxLayer>
		
		<ParallaxLayer mouseEnabled="false" xm="0.8" ym="0.8">
			<DisplayObject2D assetID="far_trees_asset" x="0" y="78" />
		</ParallaxLayer>
		
		<ParallaxLayer mouseEnabled="false" xm="0.9" ym="0.9">
			<DisplayObject2D assetID="mid_trees_asset" x="131" y="135" />
		</ParallaxLayer>
	
		<DisplayObject2D assetID="background_asset" mouseEnabled="false"/>
		<DisplayObject2D id="click" assetID="click_asset" mouseEnabled="true" clickThrough="true" alpha="0"/>
		<DisplayObject2D id="door" assetID="door_asset" x="911" y="467" mouseEnabled="true" verbEnabled="true" useHandCursor="true" alpha="0" tooltip="Go to the basement"/>
	 
		<ZSortingDisplayObject id="furniture">
			<DisplayObject2D id="well" assetID="well_asset" x="1247" y="({Room.well.originY}+{429})" originY="140" mouseEnabled="true" useHandCursor="true" scale="0.95" tooltip="Ye Olde Well"/>
			<DisplayObject2D id="house" assetID="house_asset" x="1003" y="({Room.house.originY}+{144})" originX="269" originY="354" />
			<DisplayObject2D id="window" assetID="window_asset" x="867" y="({Room.window.originY}+{375})" originY="154" />
			<DisplayObject2D id="egg" assetID="egg_asset" x="630" y="({Room.egg.originY}+{486})" originX="43" originY="50" />
			<DisplayObject2D id="sign" assetID="sign_asset" x="151" y="({Room.sign.originY}+{536})" originX="74" originY="211" />
			<DisplayObject2D id="mushroom_12" assetURL="images/beanstalk/mushroom.swf" x="924" y="({Room.mushroom_10.originY}+{570})" originX="71" originY="146" mouseEnabled="true" useHandCursor="true" mouseChildren="false" clickThrough="true" scale="0.6" clicked="false" tooltip="Musical Mushroom" rotate="325"/>
			<DisplayObject2D id="mushroom_11" assetURL="images/beanstalk/mushroom.swf" x="1144" y="({Room.mushroom_10.originY}+{400})" originX="71" originY="146" mouseEnabled="true" useHandCursor="true" mouseChildren="false" clickThrough="true" scale="0.4" clicked="false" tooltip="Musical Mushroom" rotate="25"/>
			<DisplayObject2D id="mushroom_10" assetURL="images/beanstalk/mushroom.swf" x="1324" y="({Room.mushroom_10.originY}+{645})" originX="71" originY="146" mouseEnabled="true" useHandCursor="true" mouseChildren="false" clickThrough="true" scale="0.7" clicked="false" tooltip="Musical Mushroom" />
			<DisplayObject2D id="mushroom_9" assetID="mushroom_9_asset" x="847" y="({Room.mushroom_9.originY}+{724})" originX="33" originY="58" />
			<DisplayObject2D id="mushroom_8" assetID="mushroom_8_asset" x="1481" y="({Room.mushroom_8.originY}+{576})" originX="12" originY="19" />
			<DisplayObject2D id="mushroom_7" assetURL="images/beanstalk/mushroom.swf" x="1414" y="({Room.mushroom_7.originY}+{440})" originX="28" originY="146" mouseEnabled="true" useHandCursor="true" mouseChildren="false" clickThrough="true" scale="0.5" clicked="false" tooltip="Musical Mushroom" />
			<DisplayObject2D id="mushroom_6" assetID="mushroom_6_asset" x="1416" y="({Room.mushroom_6.originY}+{565})" originX="17" originY="29" />
			<DisplayObject2D id="mushroom_5" assetID="mushroom_5_asset" x="600" y="({Room.mushroom_5.originY}+{530})" originX="12" originY="20" />
			<DisplayObject2D id="mushroom_4" assetURL="images/beanstalk/mushroom.swf" x="532" y="({Room.mushroom_4.originY}+{394})" originX="28" originY="146" mouseEnabled="true" useHandCursor="true" mouseChildren="false" clickThrough="true" scale="0.5" clicked="false" tooltip="Musical Mushroom" />
			<DisplayObject2D id="mushroom_3" assetID="mushroom_3_asset" x="534" y="({Room.mushroom_3.originY}+{519})" originX="17" originY="29" />
			<DisplayObject2D id="mushroom_2" assetID="mushroom_2_asset" x="176" y="({Room.mushroom_2.originY}+{698})" originX="25" originY="41" />
			<DisplayObject2D id="mushroom_1" assetID="mushroom_1_asset" x="125" y="({Room.mushroom_1.originY}+{699})" originX="30" originY="56" />
			<DisplayObject2D id="stump" assetID="stump_asset" x="1006" y="({Room.stump.originY}+{648})" originX="88" originY="132" />
			<DisplayObject2D id="bridge_front" assetID="bridge_front_asset" x="333" y="789" originY="230" />
			<DisplayObject2D id="bridge_back" assetID="bridge_back_asset" x="277" y="635" originY="96" />
			<DisplayObject2D id="flowers_4" assetID="flowers_4_asset" x="873" y="767" originX="42" originY="63" />
			<DisplayObject2D id="flowers_3" assetID="flowers_3_asset" x="781" y="954" originX="156" originY="172" />
			<DisplayObject2D id="flowers_2" assetID="flowers_2_asset" x="128" y="677" originX="35" originY="60" />
			<DisplayObject2D id="flowers_1" assetID="flowers_1_asset" x="226" y="926" originX="147" originY="178" />
			<DisplayObject2D id="beanstalk" assetURL="images/beanstalk/beanstalk.swf" x="130" y="525" originY="565" grown="false" tooltip="Magical Beanstalk" />
			<DisplayObject2D id="fish" assetURL="images/beanstalk/fish.swf" x="610" y="720" originY="0" />
		</ZSortingDisplayObject>
		
		<DisplayObject2D id="coll" assetID="coll_1_asset" x="912" y="517" collidable="true" distance="170" alpha="0"/>
		
		<ParallaxLayer mouseEnabled="false" xm="1.2" ym="1">
			<DisplayObject2D assetID="foreground_tree_3_asset" x="1160" y="0" />
			<DisplayObject2D assetID="foreground_tree_2_asset" x="859" y="0" />
			<DisplayObject2D assetID="foreground_tree_1_asset" x="0" y="0" />
			<DisplayObject2D assetID="fore_left_asset" x="0" y="709" />
			<DisplayObject2D assetID="fore_right_asset" x="712" y="555" />
		</ParallaxLayer>
		
		<ZSortingDisplayObject id="playerMessages"/>
	</Scene>
	
	<Assets>
        <Asset id="hit_asset" url="images/beanstalk/hit.png"/>
        <Asset id="click_asset" url="images/beanstalk/click.png"/>
        <Asset id="light_filter_asset" url="images/beanstalk/light.jpg"/>		
		<Asset id="background_asset" url="images/beanstalk/background.png"/>
		<Asset id="sky_asset" url="images/beanstalk/sky.jpg" />	
		<Asset id="far_trees_asset" url="images/beanstalk/far_trees.png" />
		<Asset id="mid_trees_asset" url="images/beanstalk/mid_trees.png" />
		<Asset id="well_asset" url="images/beanstalk/well.swf" />
		<Asset id="house_asset" url="images/beanstalk/house.png" />
		<Asset id="window_asset" url="images/beanstalk/windows.swf" />
		<Asset id="beanstalk_asset" url="images/beanstalk/beanstalk.png" />
		<Asset id="egg_asset" url="images/beanstalk/egg.png" />
		<Asset id="sign_asset" url="images/beanstalk/sign.png" />
		<Asset id="mushroom_10_asset" url="images/beanstalk/mushroom_10.png" />
		<Asset id="mushroom_9_asset" url="images/beanstalk/mushroom_9.png" />
		<Asset id="mushroom_8_asset" url="images/beanstalk/mushroom_8.png" />
		<Asset id="mushroom_7_asset" url="images/beanstalk/mushroom_7.png" />
		<Asset id="mushroom_6_asset" url="images/beanstalk/mushroom_6.png" />
		<Asset id="mushroom_5_asset" url="images/beanstalk/mushroom_5.png" />
		<Asset id="mushroom_4_asset" url="images/beanstalk/mushroom_4.png" />
		<Asset id="mushroom_3_asset" url="images/beanstalk/mushroom_3.png" />
		<Asset id="mushroom_2_asset" url="images/beanstalk/mushroom_2.png" />
		<Asset id="mushroom_1_asset" url="images/beanstalk/mushroom_1.png" />
		<Asset id="stump_asset" url="images/beanstalk/stump.png" />
		<Asset id="bridge_front_asset" url="images/beanstalk/bridge_front.png" />
		<Asset id="bridge_back_asset" url="images/beanstalk/bridge_back.png" />
		<Asset id="flowers_4_asset" url="images/beanstalk/flowers_4.png" />
		<Asset id="flowers_3_asset" url="images/beanstalk/flowers_3.png" />
		<Asset id="flowers_2_asset" url="images/beanstalk/flowers_2.png" />
		<Asset id="flowers_1_asset" url="images/beanstalk/flowers_1.png" />
		<Asset id="foreground_tree_3_asset" url="images/beanstalk/foreground_tree_3.png" />
		<Asset id="foreground_tree_2_asset" url="images/beanstalk/foreground_tree_2.png" />
		<Asset id="foreground_tree_1_asset" url="images/beanstalk/foreground_tree_1.png" />
		<Asset id="fore_left_asset" url="images/beanstalk/fore_left.png" />
		<Asset id="fore_right_asset" url="images/beanstalk/fore_right.png" />
		<Asset id="coll_1_asset" url="images/beanstalk/coll_1.png" />
		<Asset id="door_asset" url="images/beanstalk/door.gif" />
	</Assets>	
	
	<Triggers>
		<onFixup>
			<Call behaviourID="playFish" delay="({3000}~{7000})" />
			<GotoAndStop gameObject="{Room.well}" frame="1"/>
			<GotoAndStop gameObject="{Room.fish}" frame="1"/>
			<GotoAndStop gameObject="{Room.mushroom_4}" frame="1"/>
			<GotoAndStop gameObject="{Room.mushroom_7}" frame="1"/>
			<GotoAndStop gameObject="{Room.mushroom_10}" frame="1"/>
			<GotoAndStop gameObject="{Room.mushroom_11}" frame="1"/>
			<GotoAndStop gameObject="{Room.mushroom_12}" frame="1"/>
			<GotoAndStop gameObject="{Room.window}" frame="1"/>
			<GotoAndStop gameObject="{Room.beanstalk}" frame="1"/>
			<PlaySound sound="{Room.woodland_2}" delay="10000"/>
			<PlaySound sound="{Room.water_2}" delay="3000"/>
		</onFixup>
	</Triggers>
	
	<Trigger gameObject="{Room.click}" event="onClick">
		<MoveTo gameObject="{Room.player}" targetX="{Event.x}" targetY="{Event.y}" />
	</Trigger>
	
	<Trigger gameObject="{Room.well}" event="onClick">
		<GotoAndPlay gameObject="{Room.well}" frame="2"/>
		<SetValues target="{Room.well}" mouseEnabled="false" useHandCursor="false" />
		<SetValues target="{Room.well}" mouseEnabled="true" useHandCursor="true" delay="3000"/>
		<PlaySound sound="{Room.winch}" />
	</Trigger>
	
	<Trigger gameObject="{Room.coll}" event="onEnterCollision">
		<GotoAndPlay gameObject="{Room.window}" frame="({91}-{Room.collisionStatus.currentFrame})" if="({Room.collisionStatus.currentFrame}!={0})">
			<Frame>
				<GotoAndPlay gameObject="{Room.window}" frame="19" if="({Event.frame}=={74})" />
			</Frame>
		</GotoAndPlay>
		<GotoAndPlay gameObject="{Room.window}" frame="2" if="({Room.collisionStatus.currentFrame}=={0})">
			<Frame>
				<GotoAndPlay gameObject="{Room.window}" frame="19" if="({Event.frame}=={74})" />
			</Frame>
		</GotoAndPlay>
	</Trigger>
	
	<Trigger gameObject="{Room.coll}" event="onExitCollision">
		<GotoAndPlay gameObject="{Room.window}" frame="75">
			<Frame>
				<SetValues target="{Room.collisionStatus}" currentFrame="{Event.frame}" />
				<SetValues target="{Room.collisionStatus}" currentFrame="0" if="({Event.frame}=={92})" />
			</Frame>
		</GotoAndPlay>
	</Trigger>
	
	 <Trigger gameObject="{Room.mushroom_4}" event="onClick">
		<GotoAndPlay gameObject="{Room.mushroom_4}" frame="2" />
		<SetValues target="{Event.handler}" clicked="true"/>
		<PlaySound sound="{Room.mushroom_4_sound}" />
		<Call behaviourID="checkMushrooms" />
	 </Trigger>
	
	 <Trigger gameObject="{Room.mushroom_7}" event="onClick">
		<GotoAndPlay gameObject="{Room.mushroom_7}" frame="2" /> 
		<SetValues target="{Event.handler}" clicked="true"/>
		<PlaySound sound="{Room.mushroom_7_sound}" />
		<Call behaviourID="checkMushrooms" />
	 </Trigger>
	
	 <Trigger gameObject="{Room.mushroom_10}" event="onClick">
		<GotoAndPlay gameObject="{Room.mushroom_10}" frame="2" />
		<SetValues target="{Event.handler}" clicked="true"/>
		<PlaySound sound="{Room.mushroom_10_sound}" />
		<Call behaviourID="checkMushrooms" />
	 </Trigger>
	
	 <Trigger gameObject="{Room.mushroom_11}" event="onClick">
		<GotoAndPlay gameObject="{Room.mushroom_11}" frame="2" />
		<PlaySound sound="{Room.mushroom_11_sound}" />
		<SetValues target="{Room.mushroom_4}" clicked="false" />
		<SetValues target="{Room.mushroom_7}" clicked="false" />
		<SetValues target="{Room.mushroom_10}" clicked="false" />
	 </Trigger>
	
	 <Trigger gameObject="{Room.mushroom_12}" event="onClick">
		<GotoAndPlay gameObject="{Room.mushroom_12}" frame="2" />
		<PlaySound sound="{Room.mushroom_12_sound}" />
		<SetValues target="{Room.mushroom_4}" clicked="false" />
		<SetValues target="{Room.mushroom_7}" clicked="false" />
		<SetValues target="{Room.mushroom_10}" clicked="false" />
	 </Trigger>
	 
	 <Trigger gameObject="{Room.door}" event="onUse">
		<ChangeRoom roomName="basement" />
	</Trigger>
	
	<GameObject id="collisionStatus" currentFrame="0"/>

	<BehaviourDefinition id="checkMushrooms">
		<If type="and" expression1="({Room.mushroom_4.clicked}=={true})" expression2="({Room.mushroom_7.clicked}=={true})" expression3="({Room.mushroom_10.clicked}=={true})" expression4="({Room.beanstalk.grown}=={false})">
			<Then>
				<GotoAndPlay gameObject="{Room.beanstalk}" frame="2" />
				<PlaySound sound="{Room.rumble}" />
				<SetValues target="{Room.beanstalk}" grown="true"/> 
			</Then>
		</If>
	</BehaviourDefinition>

	<BehaviourDefinition id="playAgain">
		<GotoAndPlay gameObject="{Room.window}" frame="2" if="({Room.collisionStatus.canPlay}=={true})"/>
		<Call behaviourID="playAgain" if="({Room.collisionStatus.canPlay}=={false})" delay="500"/>
	</BehaviourDefinition>

	<BehaviourDefinition id="playFish">
		<GotoAndPlay gameObject="{Room.fish}" frame="2"/>
		<Call behaviourID="playFish" delay="({3000}~{7000})" />
	</BehaviourDefinition>
	
</ChatRoom>	